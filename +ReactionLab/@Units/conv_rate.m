function [y,u,f] = conv_rate(x,givenUnits,newUnits,order)%[newValue,newUnits,conversionFactor] %     = conv_rate(value,givenUnits,newUnits,rxnOrder)%% convert reaction rate constant x from givenUnits to newUnits%    based on reaction order%       units = { 'specificVolumeUnits', 'givenTimeUnits' }%  or%       units = 'specificVolumeUnits, givenTimeUnits' %%  newValue = givenValue * f% eg, [y,u,f] = conv_rate(1e13,{'cm3/mol','s'},{'cm3/molecule','s'},2)% or  [y,u,f] = conv_rate(1e13, 'cm3/mol,s',    'cm3/molecule,s',   2)% Copyright 1999-2010 Michael Frenklach% $Revision: 1.1 $% Last modified: November 20, 2010if nargin < 4   error('incorrect number of arguments')endpow = order - 1;[givenConcUnits,givenTimeUnits] = parseUnits(givenUnits);[  newConcUnits,  newTimeUnits] = parseUnits(  newUnits);if pow == 0   f = 1;   u = '1';else    f1c     = ReactionLab.Units.conv_factor(givenConcUnits);   [f2c,uc] = ReactionLab.Units.conv_factor(  newConcUnits);   if pow == 1      f = f2c/f1c;      u = uc;   else      f = (f2c/f1c)^pow;      u = ['(' uc ')^' num2str(pow)];   endend f1t     = ReactionLab.Units.conv_factor(givenTimeUnits);[f2t,ut] = ReactionLab.Units.conv_factor(  newTimeUnits);f = f/(f2t/f1t);u = [u '/' ut];y = x * f;   function [uConc,uTime] = parseUnits(u)      if ischar(u)         cc = textscan(u, '%s', 2, 'delimiter', ',');         [uConc,uTime] = parseUnits(cc{:}');      elseif iscell(u)         uConc = u{1};         uTime = u{2};      elseif isstruct(u)         uConc = u.conc;         uTime = u.time;      else         error(['undefined class ' class(u)])      end   endend